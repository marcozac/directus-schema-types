{{- define "collection" }}
// --- {{ $.Name }} ---

export type {{ $.PrimaryKey.FieldTypeName }} = "{{ $.PrimaryKey.FieldType }}";
export type {{ $.PrimaryKey.TypeName }} = {{ $.PrimaryKey.Type }};

export interface {{ $.TypeName }} {
	{{- range $spec := $.Fields }}
	{{- template "collection/field" $spec }}
	{{- end }}
}

export interface {{ $.RelationsTypeName }} {
	{{- range $spec := $.Relations }}
	{{- template "collection/relation" $spec }}
	{{- end }}
}
{{- end }}

{{/* Collection Field */}}
{{- define "collection/field" }}
	{{ with $.Note }}// {{ . }} {{- end }}
	// Type: {{ $.FieldType }}
	{{ if $.IsReadonly }}readonly {{ end }}
	{{- $.Name }}
	{{- if not $.IsRequired }}?{{ end }}: {{ $.Type }}
	{{- if $.IsNullable }} | null{{ end }};
{{ end }}

{{/* Collection Relation */}}
{{- define "collection/relation" }}
{{- if $.Unique }}
	/**
	* NOTE
	* The related field of {@link {{ $.RelatedCollection.TypeName }}} is marked as unique.
	* The resulting array will contain only one element.
	*/
{{- end }}
	{{ $.Field }}:
	{{- if $.Many }} ({{ template "collection/relation/fieldType" $ }})[]
	{{- else }} {{ template "collection/relation/fieldType" $ }}
	{{- end }}
{{ end }}

{{/* Collection Relation - Field Type */}}
{{/* Is the single-element type of a relational field. */}}
{{- define "collection/relation/fieldType" }}
	{{- $.RelatedCollection.PrimaryKey.TypeName }} | {{ $.RelatedCollection.TypeName }}
{{- end }}
